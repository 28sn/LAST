<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</title>

  <style>
    body {
      background: #f4faff;
      color: #222;
      font-family: 'Segoe UI', sans-serif;
      padding: 30px;
      text-align: center;
    }

    body.dark {
      background: #121212;
      color: #eee;
    }

    h1 {
      color: #007acc;
      margin-bottom: 15px;
    }

    .summary {
      font-size: 18px;
      margin-bottom: 25px;
      color: #444;
    }

    body.dark .summary {
      color: #bbb;
    }

    .user-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      max-width: 1200px;
      margin: auto;
    }

    .user-card {
      background: #ffffff;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.07);
      padding: 20px;
      text-align: right;
      direction: rtl;
    }

    body.dark .user-card {
      background: #1e1e1e;
    }

    .user-card h2 {
      margin: 0 0 15px;
      color: #007acc;
    }

    .stat {
      font-size: 16px;
      margin: 8px 0;
      color: #555;
    }

    body.dark .stat {
      color: #ccc;
    }

    .delete-btn {
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 14px;
    }

    .delete-btn:hover {
      background: #b52b39;
    }

    a.back {
      display: inline-block;
      margin-top: 30px;
      padding: 10px 25px;
      border-radius: 8px;
      background: #007acc;
      color: white;
      text-decoration: none;
    }

    a.back:hover {
      background: #005fa3;
    }
  </style>
</head>
<body>

  <h1>ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h1>
  <div class="summary" id="summaryInfo">ğŸ“Š ...</div>

  <div class="user-grid" id="userGrid">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</div>

  <a href="/" class="back">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

  <script>
    const theme = localStorage.getItem("theme") || "light";
    if (theme === "dark") {
      document.body.classList.add("dark");
    }

    let isAdmin = false;

    fetch("/api/users_stats")
      .then(res => res.json())
      .then(data => {
        const { users, current_user_role, total_users } = data;
        isAdmin = current_user_role === "admin";

        const grid = document.getElementById("userGrid");
        const summary = document.getElementById("summaryInfo");

        grid.innerHTML = "";
        summary.innerText = `Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${total_users} ğŸ‘¥`;

        users.forEach(user => {
          const card = document.createElement("div");
          card.className = "user-card";

          card.innerHTML = `
            <h2>ğŸ‘¤ ${user.username}</h2>
            <div class="stat">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${user.total_products}</div>
            <div class="stat">ğŸ—‘ Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ${user.expired}</div>
            <div class="stat">ğŸ”¥ Ø§Ù„Ø³Ø¹Ø±Ø§Øª: ${user.total_calories} kcal</div>
            <div class="stat">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${user.login_count} Ù…Ø±Ø©</div>
            <div class="stat">ğŸŸ¢ Ø§Ù„Ø­Ø§Ù„Ø©: ${user.online ? "Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†" : "ØºÙŠØ± Ù…ØªØµÙ„"}</div>
            <div class="stat">ğŸ† Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‹Ø§: ${user.top_used || "Ù„Ø§ Ø´ÙŠØ¡ Ø¨Ø¹Ø¯"}</div>
          `;

          if (isAdmin && user.username !== "admin") {
            const del = document.createElement("button");
            del.className = "delete-btn";
            del.innerText = "ğŸ—‘ Ø­Ø°Ù";
            del.onclick = () => deleteUser(user.username);
            card.appendChild(del);
          }

          grid.appendChild(card);
        });
      });

    function deleteUser(username) {
      if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… " + username + "?")) {
        fetch("/api/delete_user", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username })
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            alert("âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù");
            location.reload();
          } else {
            alert("âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: " + data.message);
          }
        });
      }
    }
  </script>

</body>
</html>
